<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Julien Ruaux &lt;julien@redis.com&gt;">
<title>Redis Enterprise Kafka Connector</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Redis Enterprise Kafka Connector</h1>
<div class="details">
<span id="author" class="author">Julien Ruaux &lt;julien@redis.com&gt;</span><br>
<span id="revnumber">version 6.6</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#install">2. Install</a>
<ul class="sectlevel2">
<li><a href="#download">2.1. Download</a></li>
<li><a href="#confluent-hub">2.2. Confluent Hub</a></li>
<li><a href="#manually">2.3. Manually</a></li>
</ul>
</li>
<li><a href="#connect">3. Connect to Redis</a>
<ul class="sectlevel2">
<li><a href="#configuration">3.1. Configuration</a></li>
</ul>
</li>
<li><a href="#sink">4. Sink Connector Guide</a>
<ul class="sectlevel2">
<li><a href="#features">4.1. Features</a></li>
</ul>
</li>
<li><a href="#source">5. Source Connector Guide</a>
<ul class="sectlevel2">
<li><a href="#features-2">5.1. Features</a></li>
</ul>
</li>
<li><a href="#docker">6. Quick Start with Docker</a>
<ul class="sectlevel2">
<li><a href="#requirements">6.1. Requirements</a></li>
<li><a href="#run-the-example">6.2. Run the example</a></li>
</ul>
</li>
<li><a href="#resources">7. Resources</a>
<ul class="sectlevel2">
<li><a href="#kafka">7.1. Kafka</a></li>
<li><a href="#kafka-connect">7.2. Kafka Connect</a></li>
<li><a href="#redis">7.3. Redis</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Enterprise Kafka Connector is used to import and export data between Apache Kafka and Redis Enterprise.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/redis-enterprise-kafka-connector.svg" alt="redis enterprise kafka connector"></span></p>
</div>
<div class="paragraph">
<p>This guide provides documentation and usage information across the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#install">Install</a></p>
</li>
<li>
<p><a href="#connect">Connect to Redis Enterprise</a></p>
</li>
<li>
<p><a href="#sink">Sink Connector</a></p>
</li>
<li>
<p><a href="#source">Source Connector</a></p>
</li>
<li>
<p><a href="#docker">Docker Example</a></p>
</li>
<li>
<p><a href="#resources">Resources</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install"><a class="anchor" href="#install"></a>2. Install</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Select one of the methods below to install {name}.</p>
</div>
<div class="sect2">
<h3 id="download"><a class="anchor" href="#download"></a>2.1. Download</h3>
<div class="paragraph">
<p>Download the latest release archive from <a href="https://github.com/redis-field-engineering/redis-enterprise-kafka/releases">here</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Confluent Platform Version</div>
<div class="paragraph">
<p>Download the connector archive that matches your version of Confluent Platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Confluent Platform 5.0+: <code>redis-redis-enterprise-kafka-<strong>5</strong>.6.6.zip</code></p>
</li>
<li>
<p>Confluent Platform 6.0+: <code>redis-redis-enterprise-kafka-<strong>6</strong>.6.6.zip</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="confluent-hub"><a class="anchor" href="#confluent-hub"></a>2.2. Confluent Hub</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <a href="https://docs.confluent.io/current/connect/managing/confluent-hub/client.html">Confluent Hub Client</a></p>
</li>
<li>
<p>Install the Redis Enterprise Kafka Connector using the Confluent Hub Client</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="manually"><a class="anchor" href="#manually"></a>2.3. Manually</h3>
<div class="paragraph">
<p>Follow the instructions in <a href="https://docs.confluent.io/home/connect/community.html#manually-installing-community-connectors/">Manually Installing Community Connectors</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connect"><a class="anchor" href="#connect"></a>3. Connect to Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information on configuring the Redis Enterprise Kafka Source or Sink Connector to connect to Redis Enterprise.</p>
</div>
<div class="sect2">
<h3 id="configuration"><a class="anchor" href="#configuration"></a>3.1. Configuration</h3>
<div class="paragraph">
<p>Specify the Redis URI in the <code>redis.uri</code> property, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.uri=redis://redis-12000.redis.com:12000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Details on the <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">Redis URI syntax</a> can be found in the Lettuce project <a href="https://github.com/lettuce-io/lettuce-core/wiki">wiki</a>.</p>
</div>
<div class="paragraph">
<p>TLS connection URIs start with <code>rediss://</code>.
To disable certificate verification for TLS connections use the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.insecure=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sink"><a class="anchor" href="#sink"></a>4. Sink Connector Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector consumes records from a Kafka topic and writes the data to a Redis Enterprise database.</p>
</div>
<div class="sect2">
<h3 id="features"><a class="anchor" href="#features"></a>4.1. Features</h3>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector includes the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sink-at-least-once-delivery">At least once delivery</a></p>
</li>
<li>
<p><a href="#sink-tasks">Multiple tasks</a></p>
</li>
<li>
<p><a href="#data-structures">Redis Data Structures</a></p>
</li>
<li>
<p><a href="#data-formats">Supported Data Formats</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sink-at-least-once-delivery"><a class="anchor" href="#sink-at-least-once-delivery"></a>4.1.1. At least once delivery</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector guarantees that records from the Kafka topic are delivered at least once.</p>
</div>
</div>
<div class="sect3">
<h4 id="sink-tasks"><a class="anchor" href="#sink-tasks"></a>4.1.2. Multiples tasks</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector supports running one or more tasks.
You can specify the number of tasks with the <code>tasks.max</code> configuration property.</p>
</div>
</div>
<div class="sect3">
<h4 id="data-structures"><a class="anchor" href="#data-structures"></a>4.1.3. Redis Data Structures</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector supports the following Redis data-structure types as targets:</p>
</div>
<div id="collection-key" class="ulist">
<ul>
<li>
<p>Collections: <a href="#sync-stream">stream</a>, <a href="#sync-list">list</a>, <a href="#sync-set">set</a>, <a href="#sync-zset">sorted set</a>, <a href="#sync-timeseries">time series</a></p>
<div class="paragraph">
<p>Collection keys are generated using the <code>redis.key</code> configuration property which may contain <code>${topic}</code> (default) as a placeholder for the originating topic name.</p>
</div>
<div class="paragraph">
<p>For example with <code>redis.key = ${topic}</code> and topic <code>orders</code> the Redis key is <code>set:orders</code>.</p>
</div>
</li>
<li>
<p><a href="#sync-hash">Hash</a>, <a href="#sync-string">string</a>, <a href="#sync-json">JSON</a></p>
<div class="paragraph">
<p>For other data-structures the key is in the form <code>&lt;keyspace&gt;:&lt;record_key&gt;</code> where <code>keyspace</code> is generated using the <code>redis.key</code> configuration property like above and <code>record_key</code> is the sink record key.</p>
</div>
<div class="paragraph">
<p>For example with <code>redis.key = ${topic}</code>, topic <code>orders</code>, and sink record key <code>123</code> the Redis key is <code>orders:123</code>.</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sync-hash"><a class="anchor" href="#sync-hash"></a>Hash</h5>
<div class="paragraph">
<p>Use the following properties to write Kafka records as Redis hashes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=HASH
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;Avro or JSON&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#avro">Avro</a> or <a href="#kafka-json">JSON</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sync-string"><a class="anchor" href="#sync-string"></a>String</h5>
<div class="paragraph">
<p>Use the following properties to write Kafka records as Redis strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=STRING
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#value-string">String</a> or <a href="#value-bytes">bytes</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sync-json"><a class="anchor" href="#sync-json"></a>JSON</h5>
<div class="paragraph">
<p>Use the following properties to write Kafka records as RedisJSON documents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=JSON
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#value-string">String</a> or <a href="#value-bytes">bytes</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sync-stream"><a class="anchor" href="#sync-stream"></a>Stream</h5>
<div class="paragraph">
<p>Use the following properties to store Kafka records as Redis stream messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=STREAM
redis.key=&lt;stream key&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;Avro or JSON&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#collection-key">Stream key</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#avro">Avro</a> or <a href="#kafka-json">JSON</a></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sync-list"><a class="anchor" href="#sync-list"></a>List</h5>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=LIST
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b>
redis.push.direction=&lt;LEFT or RIGHT&gt; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#collection-key">List key</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a>: Kafka record keys to push to the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>LEFT</code>: LPUSH (default), <code>RIGHT</code>: RPUSH</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kafka record value can be any format.
If a value is null then the member is removed from the list (instead of pushed to the list).</p>
</div>
</div>
<div class="sect4">
<h5 id="sync-set"><a class="anchor" href="#sync-set"></a>Set</h5>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=SET
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#collection-key">Set key</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a>: Kafka record keys to add to the set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kafka record value can be any format.
If a value is null then the member is removed from the set (instead of added to the set).</p>
</div>
</div>
<div class="sect4">
<h5 id="sync-zset"><a class="anchor" href="#sync-zset"></a>Sorted Set</h5>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis sorted set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=ZSET
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#collection-key">Sorted set key</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a>: Kafka record keys to add to the set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kafka record value should be <code>float64</code> and is used for the score.
If the score is null then the member is removed from the sorted set (instead of added to the sorted set).</p>
</div>
</div>
<div class="sect4">
<h5 id="sync-timeseries"><a class="anchor" href="#sync-timeseries"></a>Time Series</h5>
<div class="paragraph">
<p>Use the following properties to write Kafka records as RedisTimeSeries samples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.type=TIMESERIES
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#collection-key">Timeseries key</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kafka record key must be an integer (e.g. <code>int64</code>) as it is used for the sample time in milliseconds.</p>
</div>
<div class="paragraph">
<p>The Kafka record value must be a number (e.g. <code>float64</code>) as it is used as the sample value.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="data-formats"><a class="anchor" href="#data-formats"></a>4.1.4. Data Formats</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector supports different data formats for record keys and values depending on the target Redis data structure.</p>
</div>
<div class="sect4">
<h5 id="kafka-record-keys"><a class="anchor" href="#kafka-record-keys"></a>Kafka Record Keys</h5>
<div class="paragraph">
<p>The Redis Enterprise Kafka Sink Connector expects Kafka record keys in a specific format depending on the configured target <a href="#data-structures">Redis data structure</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Record Key</th>
<th class="tableblock halign-left valign-top">Assigned To</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">String</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">List</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#key-string">String</a> or <a href="#key-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">TimeSeries</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample time in milliseconds</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="key-string"><a class="anchor" href="#key-string"></a>StringConverter</h6>
<div class="paragraph">
<p>If record keys are already serialized as strings use the StringConverter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">key.converter=org.apache.kafka.connect.storage.StringConverter</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="key-bytes"><a class="anchor" href="#key-bytes"></a>ByteArrayConverter</h6>
<div class="paragraph">
<p>Use the byte array converter to use the binary serialized form of the Kafka record keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">key.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="kafka-record-values"><a class="anchor" href="#kafka-record-values"></a>Kafka Record Values</h5>
<div class="paragraph">
<p>Multiple data formats are supported for Kafka record values depending on the configured target <a href="#data-structures">Redis data structure</a>.
Each data structure expects a specific format.
If your data in Kafka is not in the format expected for a given data structure, consider using <a href="https://docs.confluent.io/platform/current/connect/transforms/overview.html">Single Message Transformations</a> to convert to a byte array, string, Struct, or map before it is written to Redis.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Record Value</th>
<th class="tableblock halign-left valign-top">Assigned To</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#avro">Avro</a> or <a href="#kafka-json">JSON</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message body</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#avro">Avro</a> or <a href="#kafka-json">JSON</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fields</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">String</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#value-string">String</a> or <a href="#value-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">List</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Score or removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#value-string">String</a> or <a href="#value-bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">TimeSeries</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample value</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="value-string"><a class="anchor" href="#value-string"></a>StringConverter</h6>
<div class="paragraph">
<p>If record values are already serialized as strings, use the StringConverter to store values in Redis as strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">value.converter=org.apache.kafka.connect.storage.StringConverter</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="value-bytes"><a class="anchor" href="#value-bytes"></a>ByteArrayConverter</h6>
<div class="paragraph">
<p>Use the byte array converter to store the binary serialized form (for example, JSON, Avro, Strings, etc.) of the Kafka record values in Redis as byte arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">value.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="avro"><a class="anchor" href="#avro"></a>Avro</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">value.converter=io.confluent.connect.avro.AvroConverter
value.converter.schema.registry.url=http://localhost:8081</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="kafka-json"><a class="anchor" href="#kafka-json"></a>JSON</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">value.converter=org.apache.kafka.connect.json.JsonConverter
value.converter.schemas.enable=&lt;true|false&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set to <code>true</code> if the JSON record structure has an attached schema</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="source"><a class="anchor" href="#source"></a>5. Source Connector Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Enterprise Kafka Source Connector reads from a Redis Enterprise stream and publishes messages to a Kafka topic.</p>
</div>
<div class="sect2">
<h3 id="features-2"><a class="anchor" href="#features-2"></a>5.1. Features</h3>
<div class="paragraph">
<p>The Redis Enterprise Kafka Source Connector includes the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#source-at-least-once-delivery">At least once delivery</a></p>
</li>
<li>
<p><a href="#source-tasks">Multiple tasks</a></p>
</li>
<li>
<p><a href="#stream-reader">Stream Reader</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="source-at-least-once-delivery"><a class="anchor" href="#source-at-least-once-delivery"></a>5.1.1. At least once delivery</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Source Connector guarantees that records from the Kafka topic are delivered at least once.</p>
</div>
</div>
<div class="sect3">
<h4 id="source-tasks"><a class="anchor" href="#source-tasks"></a>5.1.2. Multiple Tasks</h4>
<div class="paragraph">
<p>Use configuration property <code>tasks.max</code> to have the change stream handled by multiple tasks.
The connector splits the work based on the number of configured key patterns.
When the number of tasks is greater than the number of patterns, the number of patterns will be used instead.</p>
</div>
<div class="paragraph">
<p>For example <code>foo:*</code> translates to pubsub channel <code>__keyspace@0__:foo:*</code> and will capture changes to keys <code>foo:1</code>, <code>foo:2</code>, etc.
Use comma-separated values for multiple patterns (<code>foo:*,bar:*</code>)</p>
</div>
</div>
<div class="sect3">
<h4 id="stream-reader"><a class="anchor" href="#stream-reader"></a>5.1.3. Stream Reader</h4>
<div class="paragraph">
<p>The Redis Enterprise Kafka Source Connector reads messages from a stream and publishes to a Kafka topic.
Reading is done through a consumer group so that <a href="#source-tasks">multiple instances</a> of the connector configured via the <code>tasks.max</code> can consume messages in a round-robin fashion.</p>
</div>
<div class="sect4">
<h5 id="stream-message-schema"><a class="anchor" href="#stream-message-schema"></a>Stream Message Schema</h5>
<div class="sect5">
<h6 id="key-schema"><a class="anchor" href="#key-schema"></a>Key Schema</h6>
<div class="paragraph">
<p>Keys are of type String and contain the stream message id.</p>
</div>
</div>
<div class="sect5">
<h6 id="value-schema"><a class="anchor" href="#value-schema"></a>Value Schema</h6>
<div class="paragraph">
<p>The value schema defines the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Schema</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream message ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream message body</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuration-2"><a class="anchor" href="#configuration-2"></a>Configuration</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">redis.stream.name=&lt;name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
redis.stream.offset=&lt;offset&gt; <i class="conum" data-value="2"></i><b>(2)</b>
redis.stream.block=&lt;millis&gt; <i class="conum" data-value="3"></i><b>(3)</b>
redis.stream.consumer.group=&lt;group&gt; <i class="conum" data-value="4"></i><b>(4)</b>
redis.stream.consumer.name=&lt;name&gt; <i class="conum" data-value="5"></i><b>(5)</b>
topic=&lt;name&gt; <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the stream to read from.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="https://redis.io/commands/xread#incomplete-ids">Message ID</a> to start reading from (default: <code>0-0</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Maximum <a href="https://redis.io/commands/xread">XREAD</a> wait duration in milliseconds (default: <code>100</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Name of the stream consumer group (default: <code>kafka-consumer-group</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Name of the stream consumer (default: <code>consumer-${task}</code>).
May contain <code>${task}</code> as a placeholder for the task id.
For example, <code>foo${task}</code> and task <code>123</code> &#8658; consumer <code>foo123</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Destination topic (default: <code>${stream}</code>).
May contain <code>${stream}</code> as a placeholder for the originating stream name.
For example, <code>redis_${stream}</code> and stream <code>orders</code> &#8658; topic <code>redis_orders</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker"><a class="anchor" href="#docker"></a>6. Quick Start with Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides a hands-on look at the functionality of the Redis Enterprise Kafka Source and Sink Connectors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>redis-enterprise-sink</strong> connector reads data from a Kafka topic and writes it to a Redis stream</p>
</li>
<li>
<p>The <strong>redis-enterprise-source</strong> connector reads data from a Redis stream and writes it to a Kafka topic</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="requirements"><a class="anchor" href="#requirements"></a>6.1. Requirements</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/get-docker/">Docker</a></p>
</div>
</div>
<div class="sect2">
<h3 id="run-the-example"><a class="anchor" href="#run-the-example"></a>6.2. Run the example</h3>
<div class="paragraph">
<p>Clone the <a href="https://github.com/redis-field-engineering/redis-enterprise-kafka.git">redis-enterprise-kafka</a> repository and execute <code>run.sh</code> in <code>docker</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">git clone https://github.com/redis-field-engineering/redis-enterprise-kafka.git
cd redis-enterprise-kafka/docker
./run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>docker-compose up</code></p>
</li>
<li>
<p>Wait for Redis, Kafka, and Kafka Connect to be ready</p>
</li>
<li>
<p>Register the Confluent Datagen Connector</p>
</li>
<li>
<p>Register the Redis Enterprise Kafka Sink Connector</p>
</li>
<li>
<p>Register the Redis Enterprise Kafka Source Connector</p>
</li>
<li>
<p>Publish some events to Kafka via the Datagen connector</p>
</li>
<li>
<p>Write the events to Redis</p>
</li>
<li>
<p>Send messages to a Redis stream</p>
</li>
<li>
<p>Write the Redis stream messages back into Kafka</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once running, examine the topics in the Kafka control center: <a href="http://localhost:9021/" class="bare">http://localhost:9021/</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>pageviews</code> topic should contain the 10 simple documents added, each similar to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "viewtime": {
    "$numberLong": "81"
  },
  "pageid": "Page_1",
  "userid": "User_8"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>pageviews</code> stream should contain the 10 change events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examine the stream in Redis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">docker-compose exec redis /usr/local/bin/redis-cli
xread COUNT 10 STREAMS pageviews 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Messages added to the <code>mystream</code> stream will show up in the <code>mystream</code> topic</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="anchor" href="#resources"></a>7. Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="kafka"><a class="anchor" href="#kafka"></a>7.1. Kafka</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">What is Apache Kafka?</dt>
<dd>
<p><a href="https://youtu.be/06iRM1Ghr1k" class="bare">https://youtu.be/06iRM1Ghr1k</a></p>
</dd>
<dt class="hdlist1">Should You Put Several Event Types in the Same Kafka Topic?</dt>
<dd>
<p><a href="https://www.confluent.io/blog/put-several-event-types-kafka-topic/" class="bare">https://www.confluent.io/blog/put-several-event-types-kafka-topic/</a></p>
</dd>
<dt class="hdlist1">Kafka Quickstart</dt>
<dd>
<p><a href="https://kafka.apache.org/quickstart" class="bare">https://kafka.apache.org/quickstart</a></p>
</dd>
<dt class="hdlist1">Console Producer and Consumer Basics</dt>
<dd>
<p><a href="https://kafka-tutorials.confluent.io/kafka-console-consumer-producer-basics/kafka.html" class="bare">https://kafka-tutorials.confluent.io/kafka-console-consumer-producer-basics/kafka.html</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="kafka-connect"><a class="anchor" href="#kafka-connect"></a>7.2. Kafka Connect</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Introduction to Kafka Connectors</dt>
<dd>
<p><a href="https://www.baeldung.com/kafka-connectors-guide" class="bare">https://www.baeldung.com/kafka-connectors-guide</a></p>
</dd>
<dt class="hdlist1">Kafka Connect Documentation</dt>
<dd>
<p><a href="https://docs.confluent.io/platform/current/connect/index.html" class="bare">https://docs.confluent.io/platform/current/connect/index.html</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="redis"><a class="anchor" href="#redis"></a>7.3. Redis</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Redis</dt>
<dd>
<p><a href="https://redis.io/topics/introduction" class="bare">https://redis.io/topics/introduction</a></p>
</dd>
<dt class="hdlist1">Redis Streams</dt>
<dd>
<p><a href="https://redis.io/topics/streams-intro" class="bare">https://redis.io/topics/streams-intro</a></p>
</dd>
<dt class="hdlist1">Redis Enterprise Advantages</dt>
<dd>
<p><a href="https://redis.com/redis-enterprise/advantages/" class="bare">https://redis.com/redis-enterprise/advantages/</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.6<br>
Last updated 2022-06-29 04:31:32 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>