<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Julien Ruaux">
<title>Redis Kafka Connector</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Redis Kafka Connector</h1>
<div class="details">
<span id="author" class="author">Julien Ruaux</span><br>
<span id="revnumber">version 0.7.5</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_install">2. Install</a>
<ul class="sectlevel2">
<li><a href="#_download">2.1. Download</a></li>
<li><a href="#_confluent_hub">2.2. Confluent Hub</a></li>
<li><a href="#_manually">2.3. Manually</a></li>
</ul>
</li>
<li><a href="#_connect">3. Connect to Redis</a></li>
<li><a href="#_sink">4. Sink Connector Guide</a>
<ul class="sectlevel2">
<li><a href="#_sink_at_least_once_delivery">4.1. At least once delivery</a></li>
<li><a href="#_sink_tasks">4.2. Multiple tasks</a></li>
<li><a href="#_sink_data_structures">4.3. Redis Data Structures</a>
<ul class="sectlevel3">
<li><a href="#_sink_hash">4.3.1. Hash</a></li>
<li><a href="#_sink_string">4.3.2. String</a></li>
<li><a href="#_sink_json">4.3.3. JSON</a></li>
<li><a href="#_sink_stream">4.3.4. Stream</a></li>
<li><a href="#_sink_list">4.3.5. List</a></li>
<li><a href="#_sink_set">4.3.6. Set</a></li>
<li><a href="#_sink_zset">4.3.7. Sorted Set</a></li>
<li><a href="#_sink_timeseries">4.3.8. Time Series</a></li>
</ul>
</li>
<li><a href="#_sink_data_formats">4.4. Data Formats</a>
<ul class="sectlevel3">
<li><a href="#_kafka_record_keys">4.4.1. Kafka Record Keys</a></li>
<li><a href="#_kafka_record_values">4.4.2. Kafka Record Values</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_source">5. Source Connector Guide</a>
<ul class="sectlevel2">
<li><a href="#_delivery_guarantees">5.1. Delivery Guarantees</a>
<ul class="sectlevel3">
<li><a href="#_source_at_least_once_delivery">5.1.1. At-Least-Once</a></li>
<li><a href="#_source_at_most_once_delivery">5.1.2. At-Most-Once</a></li>
</ul>
</li>
<li><a href="#_source_tasks">5.2. Multiple Tasks</a></li>
<li><a href="#_stream_reader">5.3. Stream Reader</a>
<ul class="sectlevel3">
<li><a href="#_message_schema">5.3.1. Message Schema</a></li>
<li><a href="#_configuration">5.3.2. Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_docker">6. Quick Start with Docker</a>
<ul class="sectlevel2">
<li><a href="#_requirements">6.1. Requirements</a></li>
<li><a href="#_run_the_example">6.2. Run the example</a></li>
</ul>
</li>
<li><a href="#_resources">7. Resources</a>
<ul class="sectlevel2">
<li><a href="#_kafka">7.1. Kafka</a></li>
<li><a href="#_kafka_connect">7.2. Kafka Connect</a></li>
<li><a href="#_redis">7.3. Redis</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Redis Kafka Connector is used to import and export data between Apache Kafka and Redis.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/redis-kafka-connector.svg" alt="redis kafka connector"></span></p>
</div>
<div class="paragraph">
<p>This guide provides documentation and usage information across the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_install">Install</a></p>
</li>
<li>
<p><a href="#_connect">Connect to Redis</a></p>
</li>
<li>
<p><a href="#_sink">Sink Connector</a></p>
</li>
<li>
<p><a href="#_source">Source Connector</a></p>
</li>
<li>
<p><a href="#_docker">Docker Example</a></p>
</li>
<li>
<p><a href="#_resources">Resources</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install"><a class="anchor" href="#_install"></a>2. Install</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Select one of the methods below to install Redis Kafka Connector.</p>
</div>
<div class="sect2">
<h3 id="_download"><a class="anchor" href="#_download"></a>2.1. Download</h3>
<div class="paragraph">
<p>Download the latest release archive from <a href="https://github.com/{github-owner}/{github-repo}/releases">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_confluent_hub"><a class="anchor" href="#_confluent_hub"></a>2.2. Confluent Hub</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <a href="https://docs.confluent.io/current/connect/managing/confluent-hub/client.html">Confluent Hub Client</a></p>
</li>
<li>
<p>Install the redis-kafka-connect using the Confluent Hub Client</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_manually"><a class="anchor" href="#_manually"></a>2.3. Manually</h3>
<div class="paragraph">
<p>Follow the instructions in <a href="https://docs.confluent.io/home/connect/community.html#manually-installing-community-connectors/">Manually Installing Community Connectors</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect"><a class="anchor" href="#_connect"></a>3. Connect to Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information on configuring the Redis Kafka Source or Sink Connector.</p>
</div>
<div class="paragraph">
<p>Specify the Redis URI in the <code>redis.uri</code> property, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.uri=redis://redis-12000.redis.com:12000</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">Redis URI Syntax</a>.</p>
</div>
<div class="paragraph">
<p>TLS connection URIs start with <code>rediss://</code>.
To disable certificate verification for TLS connections use the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.insecure=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Username and password can be specified in the URI or separately with the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.username=user1
redis.password=pass</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sink"><a class="anchor" href="#_sink"></a>4. Sink Connector Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Kafka Sink Connector consumes records from a Kafka topic and writes the data to Redis.
It includes the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_sink_at_least_once_delivery">At least once delivery</a></p>
</li>
<li>
<p><a href="#_sink_tasks">Multiple tasks</a></p>
</li>
<li>
<p><a href="#_sink_data_structures">Redis Data Structures</a></p>
</li>
<li>
<p><a href="#_sink_data_formats">Supported Data Formats</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_sink_at_least_once_delivery"><a class="anchor" href="#_sink_at_least_once_delivery"></a>4.1. At least once delivery</h3>
<div class="paragraph">
<p>The Redis Kafka Sink Connector guarantees that records from the Kafka topic are delivered at least once.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sink_tasks"><a class="anchor" href="#_sink_tasks"></a>4.2. Multiple tasks</h3>
<div class="paragraph">
<p>The Redis Kafka Sink Connector supports running one or more tasks.
You can specify the number of tasks with the <code>tasks.max</code> configuration property.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sink_data_structures"><a class="anchor" href="#_sink_data_structures"></a>4.3. Redis Data Structures</h3>
<div class="paragraph">
<p>The Redis Kafka Sink Connector supports the following Redis data-structure types as targets:</p>
</div>
<div id="_collection_key" class="ulist">
<ul>
<li>
<p>Collections: <a href="#_sink_stream">stream</a>, <a href="#_sink_list">list</a>, <a href="#_sink_set">set</a>, <a href="#_sink_zset">sorted set</a>, <a href="#_sink_timeseries">time series</a></p>
<div class="paragraph">
<p>Collection keys are generated using the <code>redis.key</code> configuration property which may contain <code>${topic}</code> (default) as a placeholder for the originating topic name.</p>
</div>
<div class="paragraph">
<p>For example with <code>redis.key = ${topic}</code> and topic <code>orders</code> the Redis key is <code>set:orders</code>.</p>
</div>
</li>
<li>
<p><a href="#_sink_hash">Hash</a>, <a href="#_sink_string">string</a>, <a href="#_sink_json">JSON</a></p>
<div class="paragraph">
<p>For other data-structures the key is in the form <code>&lt;keyspace&gt;:&lt;record_key&gt;</code> where <code>keyspace</code> is generated using the <code>redis.key</code> configuration property like above and <code>record_key</code> is the sink record key.</p>
</div>
<div class="paragraph">
<p>For example with <code>redis.key = ${topic}</code>, topic <code>orders</code>, and sink record key <code>123</code> the Redis key is <code>orders:123</code>.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_sink_hash"><a class="anchor" href="#_sink_hash"></a>4.3.1. Hash</h4>
<div class="paragraph">
<p>Use the following properties to write Kafka records as Redis hashes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=HASH
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;Avro or JSON&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#_avro">Avro</a> or <a href="#_kafka_json">JSON</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sink_string"><a class="anchor" href="#_sink_string"></a>4.3.2. String</h4>
<div class="paragraph">
<p>Use the following properties to write Kafka records as Redis strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=STRING
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#_value_string">String</a> or <a href="#_value_bytes">bytes</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sink_json"><a class="anchor" href="#_sink_json"></a>4.3.3. JSON</h4>
<div class="paragraph">
<p>Use the following properties to write Kafka records as RedisJSON documents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=JSON
key.converter=&lt;string, bytes, or Avro&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;string, bytes, or Avro&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#_key_string">String</a>, <a href="#_key_bytes">bytes</a>, or <a href="#_avro">Avro</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#_value_string">String</a>, <a href="#_value_bytes">bytes</a>, or <a href="#_avro">Avro</a>.
If value is null the key is deleted.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sink_stream"><a class="anchor" href="#_sink_stream"></a>4.3.4. Stream</h4>
<div class="paragraph">
<p>Use the following properties to store Kafka records as Redis stream messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=STREAM
redis.key=&lt;stream key&gt; <i class="conum" data-value="1"></i><b>(1)</b>
value.converter=&lt;Avro or JSON&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#_collection_key">Stream key</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#_avro">Avro</a> or <a href="#_kafka_json">JSON</a></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sink_list"><a class="anchor" href="#_sink_list"></a>4.3.5. List</h4>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=LIST
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b>
redis.push.direction=&lt;LEFT or RIGHT&gt; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;<a href="#_collection_key">List key</a>
&lt;2&gt; <a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a>: Kafka record keys to push to the list
&lt;3&gt; <code>LEFT</code>: LPUSH (default), <code>RIGHT</code>: RPUSH</p>
</div>
<div class="paragraph">
<p>The Kafka record value can be any format.
If a value is null then the member is removed from the list (instead of pushed to the list).</p>
</div>
</div>
<div class="sect3">
<h4 id="_sink_set"><a class="anchor" href="#_sink_set"></a>4.3.6. Set</h4>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=SET
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;<a href="#_collection_key">Set key</a>
&lt;2&gt; <a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a>: Kafka record keys to add to the set</p>
</div>
<div class="paragraph">
<p>The Kafka record value can be any format.
If a value is null then the member is removed from the set (instead of added to the set).</p>
</div>
</div>
<div class="sect3">
<h4 id="_sink_zset"><a class="anchor" href="#_sink_zset"></a>4.3.7. Sorted Set</h4>
<div class="paragraph">
<p>Use the following properties to add Kafka record keys to a Redis sorted set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=ZSET
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
key.converter=&lt;string or bytes&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;<a href="#_collection_key">Sorted set key</a>
&lt;2&gt; <a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a>: Kafka record keys to add to the set</p>
</div>
<div class="paragraph">
<p>The Kafka record value should be <code>float64</code> and is used for the score.
If the score is null then the member is removed from the sorted set (instead of added to the sorted set).</p>
</div>
</div>
<div class="sect3">
<h4 id="_sink_timeseries"><a class="anchor" href="#_sink_timeseries"></a>4.3.8. Time Series</h4>
<div class="paragraph">
<p>Use the following properties to write Kafka records as RedisTimeSeries samples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.type=TIMESERIES
redis.key=&lt;key name&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#_collection_key">Timeseries key</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kafka record key must be an integer (e.g. <code>int64</code>) as it is used for the sample time in milliseconds.</p>
</div>
<div class="paragraph">
<p>The Kafka record value must be a number (e.g. <code>float64</code>) as it is used as the sample value.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sink_data_formats"><a class="anchor" href="#_sink_data_formats"></a>4.4. Data Formats</h3>
<div class="paragraph">
<p>The Redis Kafka Sink Connector supports different data formats for record keys and values depending on the target Redis data structure.</p>
</div>
<div class="sect3">
<h4 id="_kafka_record_keys"><a class="anchor" href="#_kafka_record_keys"></a>4.4.1. Kafka Record Keys</h4>
<div class="paragraph">
<p>The Redis Kafka Sink Connector expects Kafka record keys in a specific format depending on the configured target <a href="#_sink_data_structures">Redis data structure</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Record Key</th>
<th class="tableblock halign-left valign-top">Assigned To</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">String</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">List</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_key_string">String</a> or <a href="#_key_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">TimeSeries</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample time in milliseconds</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_key_string"><a class="anchor" href="#_key_string"></a>StringConverter</h5>
<div class="paragraph">
<p>If record keys are already serialized as strings use the StringConverter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">key.converter=org.apache.kafka.connect.storage.StringConverter</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_key_bytes"><a class="anchor" href="#_key_bytes"></a>ByteArrayConverter</h5>
<div class="paragraph">
<p>Use the byte array converter to use the binary serialized form of the Kafka record keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">key.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_record_values"><a class="anchor" href="#_kafka_record_values"></a>4.4.2. Kafka Record Values</h4>
<div class="paragraph">
<p>Multiple data formats are supported for Kafka record values depending on the configured target <a href="#_sink_data_structures">Redis data structure</a>.
Each data structure expects a specific format.
If your data in Kafka is not in the format expected for a given data structure, consider using <a href="https://docs.confluent.io/platform/current/connect/transforms/overview.html">Single Message Transformations</a> to convert to a byte array, string, Struct, or map before it is written to Redis.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Record Value</th>
<th class="tableblock halign-left valign-top">Assigned To</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_avro">Avro</a> or <a href="#_kafka_json">JSON</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message body</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_avro">Avro</a> or <a href="#_kafka_json">JSON</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fields</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">String</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_value_string">String</a> or <a href="#_value_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">List</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Score or removal if null</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_value_string">String</a> or <a href="#_value_bytes">bytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">TimeSeries</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample value</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_value_string"><a class="anchor" href="#_value_string"></a>StringConverter</h5>
<div class="paragraph">
<p>If record values are already serialized as strings, use the StringConverter to store values in Redis as strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">value.converter=org.apache.kafka.connect.storage.StringConverter</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_value_bytes"><a class="anchor" href="#_value_bytes"></a>ByteArrayConverter</h5>
<div class="paragraph">
<p>Use the byte array converter to store the binary serialized form (for example, JSON, Avro, Strings, etc.) of the Kafka record values in Redis as byte arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">value.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_avro"><a class="anchor" href="#_avro"></a>Avro</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">value.converter=io.confluent.connect.avro.AvroConverter
value.converter.schema.registry.url=http://localhost:8081</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kafka_json"><a class="anchor" href="#_kafka_json"></a>JSON</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">value.converter=org.apache.kafka.connect.json.JsonConverter
value.converter.schemas.enable=&lt;true|false&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set to <code>true</code> if the JSON record structure has an attached schema</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_source"><a class="anchor" href="#_source"></a>5. Source Connector Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Kafka Source Connector reads from a Redis stream and publishes messages to a Kafka topic.
It includes the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_source_at_least_once_delivery">At least once delivery</a></p>
</li>
<li>
<p><a href="#_source_at_most_once_delivery">At most once delivery</a></p>
</li>
<li>
<p><a href="#_source_tasks">Multiple tasks</a></p>
</li>
<li>
<p><a href="#_stream_reader">Stream Reader</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_delivery_guarantees"><a class="anchor" href="#_delivery_guarantees"></a>5.1. Delivery Guarantees</h3>
<div class="paragraph">
<p>The Redis Kafka Source Connector can be configured to ack stream messages either automatically (at-most-once delivery) or explicitly (at-least-once delivery).
The default is at-least-once delivery.</p>
</div>
<div class="sect3">
<h4 id="_source_at_least_once_delivery"><a class="anchor" href="#_source_at_least_once_delivery"></a>5.1.1. At-Least-Once</h4>
<div class="paragraph">
<p>In this mode, each stream message is acknowledged after it has been written to the corresponding topic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.stream.delivery=at-least-once</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_source_at_most_once_delivery"><a class="anchor" href="#_source_at_most_once_delivery"></a>5.1.2. At-Most-Once</h4>
<div class="paragraph">
<p>In this mode, stream messages are acknowledged as soon as they are read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.stream.delivery=at-most-once</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_tasks"><a class="anchor" href="#_source_tasks"></a>5.2. Multiple Tasks</h3>
<div class="paragraph">
<p>Use configuration property <code>tasks.max</code> to have the change stream handled by multiple tasks.
The connector splits the work based on the number of configured key patterns.
When the number of tasks is greater than the number of patterns, the number of patterns will be used instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stream_reader"><a class="anchor" href="#_stream_reader"></a>5.3. Stream Reader</h3>
<div class="paragraph">
<p>The Redis Kafka Source Connector reads messages from a stream and publishes to a Kafka topic.
Reading is done through a consumer group so that <a href="#_source_tasks">multiple instances</a> of the connector configured via the <code>tasks.max</code> can consume messages in a round-robin fashion.</p>
</div>
<div class="sect3">
<h4 id="_message_schema"><a class="anchor" href="#_message_schema"></a>5.3.1. Message Schema</h4>
<div class="sect4">
<h5 id="_key_schema"><a class="anchor" href="#_key_schema"></a>Key Schema</h5>
<div class="paragraph">
<p>Keys are of type String and contain the stream message id.</p>
</div>
</div>
<div class="sect4">
<h5 id="_value_schema"><a class="anchor" href="#_value_schema"></a>Value Schema</h5>
<div class="paragraph">
<p>The value schema defines the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Schema</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream message ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream message body</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a>5.3.2. Configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">redis.stream.name=&lt;name&gt; <i class="conum" data-value="1"></i><b>(1)</b>
redis.stream.offset=&lt;offset&gt; <i class="conum" data-value="2"></i><b>(2)</b>
redis.stream.block=&lt;millis&gt; <i class="conum" data-value="3"></i><b>(3)</b>
redis.stream.consumer.group=&lt;group&gt; <i class="conum" data-value="4"></i><b>(4)</b>
redis.stream.consumer.name=&lt;name&gt; <i class="conum" data-value="5"></i><b>(5)</b>
topic=&lt;name&gt; <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the stream to read from.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="https://redis.io/commands/xread#incomplete-ids">Message ID</a> to start reading from (default: <code>0-0</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Maximum <a href="https://redis.io/commands/xread">XREAD</a> wait duration in milliseconds (default: <code>100</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Name of the stream consumer group (default: <code>kafka-consumer-group</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Name of the stream consumer (default: <code>consumer-${task}</code>).
May contain <code>${task}</code> as a placeholder for the task id.
For example, <code>foo${task}</code> and task <code>123</code> &#8658; consumer <code>foo123</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Destination topic (default: <code>${stream}</code>).
May contain <code>${stream}</code> as a placeholder for the originating stream name.
For example, <code>redis_${stream}</code> and stream <code>orders</code> &#8658; topic <code>redis_orders</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker"><a class="anchor" href="#_docker"></a>6. Quick Start with Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides a hands-on look at the functionality of the Redis Kafka Source and Sink Connectors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>redis-sink</strong> connector reads data from a Kafka topic and writes it to a Redis stream</p>
</li>
<li>
<p>The <strong>redis-source</strong> connector reads data from a Redis stream and writes it to a Kafka topic</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>6.1. Requirements</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/get-docker/">Docker</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_example"><a class="anchor" href="#_run_the_example"></a>6.2. Run the example</h3>
<div class="paragraph">
<p>Clone the <a href="https://github.com/{github-owner}/{github-repo}.git">{github-repo}</a> repository and execute <code>run.sh</code> in <code>docker</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="console">git clone https://github.com/{github-owner}/{github-repo}.git
./run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>docker-compose up</code></p>
</li>
<li>
<p>Wait for Redis, Kafka, and Kafka Connect to be ready</p>
</li>
<li>
<p>Register the Confluent Datagen Connector</p>
</li>
<li>
<p>Register the Redis Kafka Sink Connector</p>
</li>
<li>
<p>Register the Redis Kafka Source Connector</p>
</li>
<li>
<p>Publish some events to Kafka via the Datagen connector</p>
</li>
<li>
<p>Write the events to Redis</p>
</li>
<li>
<p>Send messages to a Redis stream</p>
</li>
<li>
<p>Write the Redis stream messages back into Kafka</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once running, examine the topics in the Kafka control center: <a href="http://localhost:9021/" class="bare">http://localhost:9021/</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>pageviews</code> topic should contain the 10 simple documents added, each similar to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "viewtime": {
    "$numberLong": "81"
  },
  "pageid": "Page_1",
  "userid": "User_8"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>pageviews</code> stream should contain the 10 change events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examine the stream in Redis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="console">docker-compose exec redis /usr/local/bin/redis-cli
xread COUNT 10 STREAMS pageviews 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Messages added to the <code>mystream</code> stream will show up in the <code>mystream</code> topic</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources"><a class="anchor" href="#_resources"></a>7. Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kafka"><a class="anchor" href="#_kafka"></a>7.1. Kafka</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">What is Apache Kafka?</dt>
<dd>
<p><a href="https://youtu.be/06iRM1Ghr1k" class="bare">https://youtu.be/06iRM1Ghr1k</a></p>
</dd>
<dt class="hdlist1">Should You Put Several Event Types in the Same Kafka Topic?</dt>
<dd>
<p><a href="https://www.confluent.io/blog/put-several-event-types-kafka-topic/" class="bare">https://www.confluent.io/blog/put-several-event-types-kafka-topic/</a></p>
</dd>
<dt class="hdlist1">Kafka Quickstart</dt>
<dd>
<p><a href="https://kafka.apache.org/quickstart" class="bare">https://kafka.apache.org/quickstart</a></p>
</dd>
<dt class="hdlist1">Console Producer and Consumer Basics</dt>
<dd>
<p><a href="https://kafka-tutorials.confluent.io/kafka-console-consumer-producer-basics/kafka.html" class="bare">https://kafka-tutorials.confluent.io/kafka-console-consumer-producer-basics/kafka.html</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_connect"><a class="anchor" href="#_kafka_connect"></a>7.2. Kafka Connect</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Introduction to Kafka Connectors</dt>
<dd>
<p><a href="https://www.baeldung.com/kafka-connectors-guide" class="bare">https://www.baeldung.com/kafka-connectors-guide</a></p>
</dd>
<dt class="hdlist1">Kafka Connect Documentation</dt>
<dd>
<p><a href="https://docs.confluent.io/platform/current/connect/index.html" class="bare">https://docs.confluent.io/platform/current/connect/index.html</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_redis"><a class="anchor" href="#_redis"></a>7.3. Redis</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Redis</dt>
<dd>
<p><a href="https://redis.io/topics/introduction" class="bare">https://redis.io/topics/introduction</a></p>
</dd>
<dt class="hdlist1">Redis Streams</dt>
<dd>
<p><a href="https://redis.io/topics/streams-intro" class="bare">https://redis.io/topics/streams-intro</a></p>
</dd>
<dt class="hdlist1">Redis Enterprise Advantages</dt>
<dd>
<p><a href="https://redis.com/redis-enterprise/advantages/" class="bare">https://redis.com/redis-enterprise/advantages/</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.7.5<br>
Last updated 2023-06-21 19:14:08 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>